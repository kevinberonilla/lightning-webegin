<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Send Survey Modal</title>
    <link rel="stylesheet" href="assets/styles/salesforce-lightning-design-system.css">
    <link rel="stylesheet" href="css/main.css">
</head>

<body>
    <div class="slds">
        <!-- Page Header -->
        <div class="slds-page-header" role="banner">
            <div class="slds-grid">
                <div class="slds-col slds-has-flexi-truncate">
                    <nav class="slds-m-bottom--xx-small" role="navigation" aria-label="Breadcrumbs">
                        <ol class="slds-breadcrumb slds-list--horizontal">
                            <li class="slds-breadcrumb__item slds-text-title--caps"><a href="javascript:void(0);">Accounts</a></li>
                            <li class="slds-breadcrumb__item slds-text-title--caps"><a href="javascript:void(0);">General Electric</a></li>
                        </ol>
                    </nav>
                    <h1 class="slds-page-header__title slds-truncate" title="Contacts (will truncate)">Send Survey</h1>
                </div>
                <div class="slds-col slds-no-flex slds-grid slds-align-top">
                    <button class="slds-button slds-button--neutral">Cancel</button>
                    <button class="slds-button slds-button--neutral slds-button--brand js-send">Send<span class="js-number"> 2</span></button>
                </div>
            </div>
        </div>
        <!-- /Page Header -->
        <div class="slds-container slds-container--medium slds-container--center slds-p-around--large">
            <div class="slds-box">
                <!-- Recipients -->
                <label class="slds-form-element__label">Recipients</label>
                <div class="qbs-pill_container js-pill-container">
                    <!-- Pre-populated Recipient -->
                    <span id="rossbelmont" class="slds-pill">
                    <span class="slds-icon_container slds-icon-standard-contact slds-pill__icon_container">
                        <svg aria-hidden="true" class="slds-icon">
                            <use xlink:href="assets/icons/standard-sprite/svg/symbols.svg#contact"></use>
                        </svg>
                        <span class="slds-assistive-text">Contact</span>
                    </span>
                    Ross Belmont
                    <button class="slds-button slds-button--icon slds-pill__remove slds-m-left--xx-small" data-aljs-dismiss="pill">
                        <svg aria-hidden="true" class="slds-button__icon">
                            <use xlink:href="assets/icons/utility-sprite/svg/symbols.svg#close"></use>
                        </svg>
                        <span class="slds-assistive-text">Remove</span>
                    </button>
                    </span>
                    <!-- /Pre-populated Recipient -->
                    <!-- Pre-populated Recipient -->
                    <span id="kevinberonilla" class="slds-pill">
                    <span class="slds-icon_container slds-icon-standard-contact slds-pill__icon_container">
                        <svg aria-hidden="true" class="slds-icon">
                            <use xlink:href="assets/icons/standard-sprite/svg/symbols.svg#contact"></use>
                        </svg>
                        <span class="slds-assistive-text">Contact</span>
                    </span>
                    Kevin Beronilla
                    <button class="slds-button slds-button--icon slds-pill__remove slds-m-left--xx-small" data-aljs-dismiss="pill">
                        <svg aria-hidden="true" class="slds-button__icon">
                            <use xlink:href="assets/icons/utility-sprite/svg/symbols.svg#close"></use>
                        </svg>
                        <span class="slds-assistive-text">Remove</span>
                    </button>
                    </span>
                    <!-- /Pre-populated Recipient -->
                </div>
                <div class="slds-form-element slds-lookup" data-select="single">
                    <div class="slds-form-element__control">
                        <div class="slds-input-has-icon slds-input-has-icon--right">
                            <svg aria-hidden="true" class="slds-input__icon">
                                <use xlink:href="assets/icons/utility-sprite/svg/symbols.svg#search"></use>
                            </svg>
                            <input id="lookup" class="slds-lookup__search-input slds-input" type="search" placeholder="Search" aria-owns="lookup" role="combobox" aria-activedescendent="" aria-expanded="false" aria-autocomplete="list" />
                        </div>
                    </div>
                </div>
                <!-- /Recipients -->
                <div class="slds-text-align--right slds-m-top--medium">
                    <button class="slds-button slds-button--neutral">Cancel</button>
                    <button class="slds-button slds-button--neutral slds-button--brand js-send">Send<span class="js-number"> 2</span></button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="js/moment.js"></script>
    <script src="js/svg4everybody.min.js"></script>
    <script src="js/jquery.aljs-all.min.js"></script>
    <script>
        svg4everybody();

        $(document).ready(function() {
            $.aljsInit({
                scoped: true,
                assetsLocation: '.'
            });

            $('body').pill();

            var lookup = $('#lookup'),
                pillContainer = $('.js-pill-container'),
                sendButton = $('.js-send'),
                sendButtonNumber = $('.js-number'),
                removedResults = [{
                    id: 'rossbelmont',
                    label: 'Ross Belmont'
                }, {
                    id: 'kevinberonilla',
                    label: 'Kevin Beronilla'
                }, ];

            var pillMarkup =
                '<span class="slds-pill">' +
                '<span class="slds-icon_container slds-icon-standard-contact slds-pill__icon_container">' +
                '<svg aria-hidden="true" class="slds-icon">' +
                '<use xlink:href="assets/icons/standard-sprite/svg/symbols.svg#contact"></use>' +
                '</svg>' +
                '<span class="slds-assistive-text">Contact</span>' +
                '</span>' +
                '{{pillLabel}}' +
                '<button class="slds-button slds-button--icon slds-pill__remove slds-m-left--xx-small" data-aljs-dismiss="pill">' +
                '<svg aria-hidden="true" class="slds-button__icon">' +
                '<use xlink:href="assets/icons/utility-sprite/svg/symbols.svg#close"></use>' +
                '</svg>' +
                '<span class="slds-assistive-text">Remove</span>' +
                '</button>' +
                '</span>';

            var results = [{
                id: 'mikeblazek',
                label: 'Michael Blazek'
            }, {
                id: 'sergioflores',
                label: 'Sergio Flores'
            }, {
                id: 'burhanislami',
                label: 'Burhan Islami'
            }, {
                id: 'georgekenessey',
                label: 'George Kenessey'
            }, ];

            function checkNumOfPills() {
                var numOfPills = $('.slds-pill', pillContainer).length;

                sendButtonNumber.text(numOfPills ? ' ' + numOfPills : '');

                if (sendButtonNumber.text().trim()) sendButton.attr('disabled', false);
                else sendButton.attr('disabled', true);
            }

            lookup.lookup({
                items: results,
                onChange: function(currentSelection, isAdd) {
                    if (isAdd) {
                        var closeButton = $('.slds-lookup .slds-pill_container .slds-pill__remove'),
                            selectionLabel = currentSelection.label.replace(/<(.*?)>/g, '');

                        removedResults.push(currentSelection);
                        results.splice(results.indexOf(currentSelection), 1);

                        pillContainer.append(pillMarkup.replace(/{{pillLabel}}/g, selectionLabel));
                        closeButton.click();
                        checkNumOfPills();

                        $('.slds-pill', pillContainer).last().one('dismissed.aljs.pill', function() {
                                var thisId = $(this).attr('id');

                                for (var i = 0; i < removedResults.length; i++) {
                                    if (removedResults[i].id === thisId) {
                                        results.push(removedResults[i]);
                                        removedResults.splice(i, 1);
                                    }
                                }

                                setTimeout(function() {
                                    checkNumOfPills();
                                }, 10);

                                /*setTimeout(function() {
                                    lookup.focus();
                                }, 250);*/
                            })
                            .attr('id', currentSelection.id);
                    }
                },
                objectIconUrl: 'assets/icons/standard-sprite/svg/symbols.svg#contact',
                objectIconClass: 'slds-icon-standard-contact',
            });

            $('.slds-pill', pillContainer).one('dismissed.aljs.pill', function() {
                    var thisId = $(this).attr('id');

                    for (var i = 0; i < removedResults.length; i++) {
                        if (removedResults[i].id === thisId) {
                            results.push(removedResults[i]);
                            removedResults.splice(i, 1);
                        }
                    }

                    setTimeout(function() {
                        checkNumOfPills();
                    }, 10);

                    /*setTimeout(function() {
                        lookup.focus();
                    }, 250);*/
                })
                .attr('id', currentSelection.id);
        });

    </script>
</body>

</html>
